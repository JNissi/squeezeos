From a446a9618afcff25b527671b667bf9101225206d Mon Sep 17 00:00:00 2001
From: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>
Date: Wed, 7 Jan 2009 13:52:34 +0200
Subject: [PATCH] UBIFS: compat: add div_u64()

Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>
---
 fs/ubifs/budget.c |    1 -
 fs/ubifs/debug.c  |    1 -
 fs/ubifs/debug.h  |   13 +++++++++++++
 fs/ubifs/lpt.c    |    1 -
 fs/ubifs/sb.c     |    1 -
 fs/ubifs/super.c  |    1 -
 6 files changed, 13 insertions(+), 5 deletions(-)

diff --git a/fs/ubifs/budget.c b/fs/ubifs/budget.c
index 31870d8..d3057b1 100644
--- a/fs/ubifs/budget.c
+++ b/fs/ubifs/budget.c
@@ -32,7 +32,6 @@
 
 #include "ubifs.h"
 #include <linux/writeback.h>
-#include <linux/math64.h>
 
 /*
  * When pessimistic budget calculations say that there is no enough space,
diff --git a/fs/ubifs/debug.c b/fs/ubifs/debug.c
index d315f42..23d763f 100644
--- a/fs/ubifs/debug.c
+++ b/fs/ubifs/debug.c
@@ -33,7 +33,6 @@
 #include <linux/module.h>
 #include <linux/moduleparam.h>
 #include <linux/debugfs.h>
-#include <linux/math64.h>
 
 #ifdef CONFIG_UBIFS_FS_DEBUG
 
diff --git a/fs/ubifs/debug.h b/fs/ubifs/debug.h
index 9820d69..697fb8e 100644
--- a/fs/ubifs/debug.h
+++ b/fs/ubifs/debug.h
@@ -462,4 +462,17 @@ void dbg_debugfs_exit_fs(struct ubifs_info *c);
 #define dbg_debugfs_exit_fs(c)                     0
 
 #endif /* !CONFIG_UBIFS_FS_DEBUG */
+
+/*
+ * Some compatibility stuff goes here.
+ */
+
+#include <asm/div64.h>
+
+static inline uint64_t div_u64(uint64_t dividend, uint64_t divisor)
+{
+	do_div(dividend, divisor);
+	return dividend;
+}
+
 #endif /* !__UBIFS_DEBUG_H__ */
diff --git a/fs/ubifs/lpt.c b/fs/ubifs/lpt.c
index b2792e8..26319a4 100644
--- a/fs/ubifs/lpt.c
+++ b/fs/ubifs/lpt.c
@@ -45,7 +45,6 @@
 
 #include "ubifs.h"
 #include <linux/crc16.h>
-#include <linux/math64.h>
 
 /**
  * do_calc_lpt_geom - calculate sizes for the LPT area.
diff --git a/fs/ubifs/sb.c b/fs/ubifs/sb.c
index 604d658..98c0cc5 100644
--- a/fs/ubifs/sb.c
+++ b/fs/ubifs/sb.c
@@ -28,7 +28,6 @@
 
 #include "ubifs.h"
 #include <linux/random.h>
-#include <linux/math64.h>
 
 /*
  * Default journal size in logical eraseblocks as a percent of total
diff --git a/fs/ubifs/super.c b/fs/ubifs/super.c
index ca05416..2d09f70 100644
--- a/fs/ubifs/super.c
+++ b/fs/ubifs/super.c
@@ -34,7 +34,6 @@
 #include <linux/parser.h>
 #include <linux/seq_file.h>
 #include <linux/mount.h>
-#include <linux/math64.h>
 #include <linux/writeback.h>
 #include "ubifs.h"
 
-- 
1.5.6.3


From 9215e2972e74d23419d35604e9f3b989a95ab743 Mon Sep 17 00:00:00 2001
From: Katherine Lu <katherine.lu@freescale.com>
Date: Thu, 17 Jul 2008 15:07:27 +0800
Subject: [PATCH] ENGR00058757 MX35 Bluetooth power on/off support

MX35 Bluetooth power on/off and reset support

Signed-off-by: Katherine Lu <katherine.lu@freescale.com>
---
 arch/arm/configs/imx35_3stack_defconfig |    5 +++++
 arch/arm/mach-mx35/mx35_3stack.c        |   30 ++++++++++++++++++++++++++++++
 drivers/mxc/bt/Kconfig                  |    2 +-
 3 files changed, 36 insertions(+), 1 deletions(-)

diff --git a/arch/arm/configs/imx35_3stack_defconfig b/arch/arm/configs/imx35_3stack_defconfig
index 9706d7b..25dd943 100644
--- a/arch/arm/configs/imx35_3stack_defconfig
+++ b/arch/arm/configs/imx35_3stack_defconfig
@@ -1306,6 +1306,11 @@ CONFIG_MXC_MC9SDZ60_POWER=y
 CONFIG_MXC_ASRC=y
 
 #
+# MXC Bluetooth support
+#
+CONFIG_MXC_BLUETOOTH=m
+
+#
 # File systems
 #
 CONFIG_EXT2_FS=y
diff --git a/arch/arm/mach-mx35/mx35_3stack.c b/arch/arm/mach-mx35/mx35_3stack.c
index 0b4d70a..f32e46d 100644
--- a/arch/arm/mach-mx35/mx35_3stack.c
+++ b/arch/arm/mach-mx35/mx35_3stack.c
@@ -590,6 +590,35 @@ static void __init fixup_mxc_board(struct machine_desc *desc, struct tag *tags,
 #endif
 }
 
+static void bt_reset(void)
+{
+	pmic_gpio_set_bit_val(MCU_GPIO_REG_RESET_1, 2, 0);
+	msleep(5);
+	pmic_gpio_set_bit_val(MCU_GPIO_REG_RESET_1, 2, 1);
+}
+
+static struct mxc_bt_platform_data mxc_bt_data = {
+	.bt_vdd = "SW1",
+	.bt_vdd_parent = NULL,
+	.bt_vusb = NULL,
+	.bt_vusb_parent = NULL,
+	.bt_reset = bt_reset,
+};
+
+static struct platform_device mxc_bt_device = {
+	.name = "mxc_bt",
+	.id = 0,
+	.dev = {
+		.release = mxc_nop_release,
+		.platform_data = &mxc_bt_data,
+		},
+};
+
+static void mxc_init_bluetooth(void)
+{
+	(void)platform_device_register(&mxc_bt_device);
+}
+
 /*!
  * Board specific initialization.
  */
@@ -616,6 +645,7 @@ static void __init mxc_board_init(void)
 				ARRAY_SIZE(mxc_spi_board_info));
 	mxc_init_mmc();
 	mxc_init_pata();
+	mxc_init_bluetooth();
 
 	pm_power_off = pmic_power_off;
 }
diff --git a/drivers/mxc/bt/Kconfig b/drivers/mxc/bt/Kconfig
index 6ee6221..73afe9b 100644
--- a/drivers/mxc/bt/Kconfig
+++ b/drivers/mxc/bt/Kconfig
@@ -6,7 +6,7 @@ menu "MXC Bluetooth support"
 
 config MXC_BLUETOOTH
 	tristate "MXC Bluetooth support"
-	depends on MACH_MX31_3DS
+	depends on MACH_MX31_3DS || MACH_MX35_3DS
 	---help---
          Say Y to get the third party Bluetooth service.
 
-- 
1.5.4.4


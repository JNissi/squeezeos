From 3e1a09c4939ec4ae0bb7b7211864c91310e4b82a Mon Sep 17 00:00:00 2001
From: Lily Zhang <r58066@freescale.com>
Date: Mon, 14 Jul 2008 10:59:23 +0800
Subject: [PATCH] ENGR00083814 Support MX35 power off function

PMIC enter off mode when poweroff command is issued

Signed-off-by: Lily Zhang <r58066@freescale.com>
---
 arch/arm/mach-mx35/mx35_3stack.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-mx35/mx35_3stack.c b/arch/arm/mach-mx35/mx35_3stack.c
index 868fc39..9ff9aa1 100644
--- a/arch/arm/mach-mx35/mx35_3stack.c
+++ b/arch/arm/mach-mx35/mx35_3stack.c
@@ -557,6 +557,13 @@ static void __init mxc_init_pata(void)
 }
 #endif				/* CONFIG_PATA_FSL */
 
+static void pmic_power_off(void)
+{
+#ifdef CONFIG_MXC_PMIC_MC9SDZ60
+	pmic_write_reg(REG_MCU_POWER_CTL, 0x10, 0x10);
+#endif
+}
+
 /*!
  * Board specific fixup function. It is called by \b setup_arch() in
  * setup.c file very early on during kernel starts. It allows the user to
@@ -609,6 +616,8 @@ static void __init mxc_board_init(void)
 				ARRAY_SIZE(mxc_spi_board_info));
 	mxc_init_mmc();
 	mxc_init_pata();
+
+	pm_power_off = pmic_power_off;
 }
 
 #define PLL_PCTL_REG(brmo, pd, mfd, mfi, mfn)		\
-- 
1.5.4.4


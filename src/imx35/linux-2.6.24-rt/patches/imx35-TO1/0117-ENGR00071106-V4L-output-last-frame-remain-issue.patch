From 33a3a53c72d358c8704b7c570bf69c2cd92f955e Mon Sep 17 00:00:00 2001
From: Jason Chen <b02280@freescale.com>
Date: Thu, 3 Apr 2008 14:45:27 +0800
Subject: [PATCH] ENGR00071106 V4L output last frame remain issue

Last frame will remain in FG after steamoff.

Signed-off-by: Jason Chen <b02280@freescale.com>
---
 drivers/media/video/mxc/output/mxc_v4l2_output.c |    7 +++++++
 drivers/video/mxc/mxcfb.c                        |    3 +++
 2 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/drivers/media/video/mxc/output/mxc_v4l2_output.c b/drivers/media/video/mxc/output/mxc_v4l2_output.c
old mode 100644
new mode 100755
index 9e9809c..38e7e60
--- a/drivers/media/video/mxc/output/mxc_v4l2_output.c
+++ b/drivers/media/video/mxc/output/mxc_v4l2_output.c
@@ -800,6 +800,13 @@ static int mxc_v4l2out_streamoff(vout_data * vout)
 		} else {
 			fbi->var.activate |= FB_ACTIVATE_FORCE;
 			fb_set_var(fbi, &fbi->var);
+
+			if (vout->display_ch == MEM_FG_SYNC) {
+				acquire_console_sem();
+				fb_blank(fbi, FB_BLANK_POWERDOWN);
+				release_console_sem();
+			}
+
 			vout->display_bufs[0] = 0;
 			vout->display_bufs[1] = 0;
 		}
diff --git a/drivers/video/mxc/mxcfb.c b/drivers/video/mxc/mxcfb.c
old mode 100644
new mode 100755
index a1c5d63..17fd312
--- a/drivers/video/mxc/mxcfb.c
+++ b/drivers/video/mxc/mxcfb.c
@@ -202,6 +202,9 @@ static int mxcfb_set_par(struct fb_info *fbi)
 
 	ipu_init_channel(mxc_fbi->ipu_ch, NULL);
 
+	/* Clear the screen */
+	memset((char *)fbi->screen_base, 0, fbi->fix.smem_len);
+
 	if (mxc_fbi->ipu_ch == MEM_SDC_BG) {
 		memset(&sig_cfg, 0, sizeof(sig_cfg));
 		if (fbi->var.sync & FB_SYNC_HOR_HIGH_ACT)
-- 
1.5.4.4


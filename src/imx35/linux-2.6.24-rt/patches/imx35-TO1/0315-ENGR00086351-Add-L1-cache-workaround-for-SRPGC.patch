From 3bb52224f25b4f62fa7c6bdec7adfee190f65ea6 Mon Sep 17 00:00:00 2001
From: Nancy Chen <Nancy.Chen@freescale.com>
Date: Fri, 1 Aug 2008 16:08:35 -0500
Subject: [PATCH] ENGR00086351 Add L1 cache workaround for SRPGC

Add L1 cache workaround for SRPGC on i.MX37_3stack

Signed-off-by: Nancy Chen <Nancy.Chen@freescale.com>
---
 arch/arm/mach-mx37/system.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-mx37/system.c b/arch/arm/mach-mx37/system.c
index 0664f90..9d6bf6e 100644
--- a/arch/arm/mach-mx37/system.c
+++ b/arch/arm/mach-mx37/system.c
@@ -18,6 +18,7 @@
 #include <asm/hardware.h>
 #include <asm/proc-fns.h>
 #include <asm/system.h>
+#include <asm/cacheflush.h>
 #include <asm/arch/clock.h>
 #include "crm_regs.h"
 
@@ -84,6 +85,8 @@ void mxc_cpu_lp_set(enum mxc_cpu_pwr_mode mode)
 	__raw_writel(arm_srpgcr, MXC_SRPGC_ARM_SRPGCR);
 	/* __raw_writel(empgcr0, MXC_EMPGC0_ARM_EMPGCR); TODO: system crash */
 	__raw_writel(empgcr1, MXC_EMPGC1_ARM_EMPGCR);
+
+	flush_cache_all();
 }
 
 void mxc_pg_enable(struct platform_device *pdev)
-- 
1.5.4.4


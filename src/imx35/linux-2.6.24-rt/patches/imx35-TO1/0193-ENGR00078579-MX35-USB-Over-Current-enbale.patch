From df7437d5000d9bff6b28c1afc2489622aa9c0705 Mon Sep 17 00:00:00 2001
From: Jun Li <r65092@freescale.com>
Date: Mon, 2 Jun 2008 15:05:12 +0800
Subject: [PATCH] ENGR00078579 MX35 USB Over Current enbale

Enbale i.MX35 usb Over Current for OTG and Host2

Signed-off-by: Jun Li <r65092@freescale.com>
---
 arch/arm/mach-mx35/mx35_3stack_gpio.c |    2 +-
 arch/arm/plat-mxc/usb_common.c        |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-mx35/mx35_3stack_gpio.c b/arch/arm/mach-mx35/mx35_3stack_gpio.c
index 0797abe..acccfa3 100644
--- a/arch/arm/mach-mx35/mx35_3stack_gpio.c
+++ b/arch/arm/mach-mx35/mx35_3stack_gpio.c
@@ -627,7 +627,7 @@ int gpio_usbh2_active(void)
 	mxc_iomux_set_pad(MX35_PIN_I2C2_CLK, 0x0040);
 
 	mxc_request_iomux(MX35_PIN_I2C2_DAT, MUX_CONFIG_ALT2);
-	mxc_iomux_set_input(MUX_IN_USB_UH2_USB_OC, INPUT_CTL_PATH1);
+	mxc_iomux_set_input(MUX_IN_USB_UH2_USB_OC, INPUT_CTL_PATH0);
 	mxc_iomux_set_pad(MX35_PIN_I2C2_DAT, 0x01c0);
 
 	return 0;
diff --git a/arch/arm/plat-mxc/usb_common.c b/arch/arm/plat-mxc/usb_common.c
index 7b80583..a116649 100644
--- a/arch/arm/plat-mxc/usb_common.c
+++ b/arch/arm/plat-mxc/usb_common.c
@@ -344,6 +344,7 @@ static void usbh2_set_serial_xcvr(void)
 
 	USBCTRL &= ~(UCTRL_H2SIC_MASK);	/* Disable bypass mode */
 	USBCTRL &= ~(UCTRL_H2PM);	/* Power Mask */
+	USBCTRL &= ~UCTRL_OCPOL;	/* OverCurrent Polarity is Low Active */
 	USBCTRL |= UCTRL_H2WIE |	/* Wakeup intr enable */
 	    UCTRL_IP_PUE_DOWN |	/* ipp_pue_pulldwn_dpdm */
 	    UCTRL_USBTE |	/* USBT is enabled */
@@ -584,7 +585,6 @@ static void otg_set_utmi_xcvr(void)
 	UOG_USBCMD |= UCMD_RESET;
 	while ((UOG_USBCMD) & (UCMD_RESET)) ;
 
-	USBCTRL &= ~UCTRL_OCE;	/* Disable OverCurrent signal */
 	USBCTRL &= ~UCTRL_PP;	/* USBOTG_PWR low active */
 	USBCTRL &= ~UCTRL_OCPOL;	/* OverCurrent Polarity is Low Active */
 	USBCTRL &= ~UCTRL_OPM;	/* OTG Power Mask */
-- 
1.5.4.4


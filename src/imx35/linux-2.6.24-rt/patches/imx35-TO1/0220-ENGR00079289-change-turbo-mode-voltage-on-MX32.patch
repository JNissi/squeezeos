From c947854dbf90b349760b5ad74c60de3b3d50b869 Mon Sep 17 00:00:00 2001
From: Nancy Chen <Nancy.Chen@freescale.com>
Date: Mon, 23 Jun 2008 12:58:15 -0500
Subject: [PATCH] ENGR00079289 change turbo mode voltage on MX32

change turbo mode voltage on MX32 from 1.62V to 1.425V

Signed-off-by: Nancy Chen <Nancy.Chen@freescale.com>
---
 arch/arm/mach-mx3/dvfs_v2.c |   18 ++++++++----------
 arch/arm/plat-mxc/dptc.c    |   14 +++++++-------
 2 files changed, 15 insertions(+), 17 deletions(-)

diff --git a/arch/arm/mach-mx3/dvfs_v2.c b/arch/arm/mach-mx3/dvfs_v2.c
index 7f525ca..cd54a6e 100644
--- a/arch/arm/mach-mx3/dvfs_v2.c
+++ b/arch/arm/mach-mx3/dvfs_v2.c
@@ -324,24 +324,22 @@ void pmic_voltage_init(void)
 {
 	t_regulator_voltage volt;
 
-	/* Enable 4 mc13783 output voltages */
-	pmic_write_reg(REG_ARBITRATION_SWITCHERS, 1, (1 << 5));
-
-	/* Enable mc13783 voltage ready signal */
-	pmic_write_reg(REG_INTERRUPT_MASK_1, 0, (1 << 11));
-
 	/* Set mc13783 DVS speed 25mV each 4us */
-	pmic_write_reg(REG_SWITCHERS_4, 1 << 6, (3 << 6));
+	pmic_write_reg(REG_SWITCHERS_4, (0 << 6), (3 << 6));
 
-	/* Set mc13783 SW1A operating mode in normal mode */
-	pmic_write_reg(REG_SWITCHERS_4, (1 << 0), (3 << 0));
+	if (cpu_is_mx31())
+		volt.sw1a = SW1A_1_625V;
+	else
+		volt.sw1a = SW1A_1_425V;
 
-	volt.sw1a = SW1A_1_625V;
 	pmic_power_regulator_set_voltage(SW_SW1A, volt);
 
 	volt.sw1a = SW1A_1_25V;
 	pmic_power_switcher_set_dvs(SW_SW1A, volt);
 
+	volt.sw1a = SW1A_0_975V;
+	pmic_power_switcher_set_stby(SW_SW1A, volt);
+
 	volt.sw1b = SW1A_1_25V;
 	pmic_power_switcher_set_dvs(SW_SW1B, volt);
 
diff --git a/arch/arm/plat-mxc/dptc.c b/arch/arm/plat-mxc/dptc.c
index 040825f..28dc341 100644
--- a/arch/arm/plat-mxc/dptc.c
+++ b/arch/arm/plat-mxc/dptc.c
@@ -416,14 +416,14 @@ static struct platform_driver mxc_dptc_v2_driver = {
 
 static int __init dptc_init(void)
 {
-	if (platform_driver_register(&mxc_dptc_v2_driver) != 0) {
-		printk(KERN_ERR
-		       "Driver register failed for mxc_dptc_v2_driver\n");
-		return -ENODEV;
-	}
-
-	printk("DPTC driver module loaded\n");
+	if (cpu_is_mx31()) {
+		if (platform_driver_register(&mxc_dptc_v2_driver) != 0) {
+			printk(KERN_ERR "mxc_dptc_v2_driver register failed\n");
+			return -ENODEV;
+		}
 
+		printk(KERN_INFO "DPTC driver module loaded\n");
+	}
 	return 0;
 }
 
-- 
1.5.4.4


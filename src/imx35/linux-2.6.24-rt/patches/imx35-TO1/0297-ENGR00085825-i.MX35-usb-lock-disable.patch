From 6a90d3f1e694b199177717c8c2db7be9f1ed9008 Mon Sep 17 00:00:00 2001
From: Jun Li <r65092@freescale.com>
Date: Wed, 30 Jul 2008 11:25:18 +0800
Subject: [PATCH] ENGR00085825 i.MX35 usb lock disable

Disable USB bus lock in i.MX35

Signed-off-by: Jun Li <r65092@freescale.com>
---
 arch/arm/plat-mxc/usb_common.c     |    2 ++
 include/asm-arm/arch-mxc/arc_otg.h |    2 ++
 2 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-mxc/usb_common.c b/arch/arm/plat-mxc/usb_common.c
index 72ea2f4..95e5b99 100644
--- a/arch/arm/plat-mxc/usb_common.c
+++ b/arch/arm/plat-mxc/usb_common.c
@@ -303,6 +303,7 @@ static void usbh2_set_serial_xcvr(void)
 	USBCTRL &= ~(UCTRL_H2PM);	/* Power Mask */
 	USBCTRL &= ~UCTRL_OCPOL;	/* OverCurrent Polarity is Low Active */
 	USBCTRL |= UCTRL_H2WIE |	/* Wakeup intr enable */
+		UCTRL_H2LOCKD |		/* Host2 Lock Disable */
 	    UCTRL_IP_PUE_DOWN |	/* ipp_pue_pulldwn_dpdm */
 	    UCTRL_USBTE |	/* USBT is enabled */
 	    UCTRL_H2DT;		/* Disable H2 TLL */
@@ -529,6 +530,7 @@ static void otg_set_utmi_xcvr(void)
 	USBCTRL &= ~UCTRL_OCPOL;	/* OverCurrent Polarity is Low Active */
 	USBCTRL &= ~UCTRL_OPM;	/* OTG Power Mask */
 	USBCTRL |= UCTRL_OWIE;	/* OTG Wakeup Intr Enable */
+	USBCTRL |= UCTRL_OLOCKD;	/* OTG Lock Disable */
 
 	/* set UTMI xcvr */
 	tmp = UOG_PORTSC1 & ~PORTSC_PTS_MASK;
diff --git a/include/asm-arm/arch-mxc/arc_otg.h b/include/asm-arm/arch-mxc/arc_otg.h
index 22b9821..7c7e09d 100644
--- a/include/asm-arm/arch-mxc/arc_otg.h
+++ b/include/asm-arm/arch-mxc/arc_otg.h
@@ -249,6 +249,8 @@
 #define UCTRL_H1SIC_DB4		(1 << 13)	/* Differential/bidirectional  4 wire */
 #define UCTRL_H1SIC_SU6		(2 << 13)	/* single-ended/unidirectional 6 wire */
 #define UCTRL_H1SIC_SB3		(3 << 13)	/* single-ended/bidirectional  3 wire */
+#define UCTRL_OLOCKD		(1 << 13)	/* otg lock disable */
+#define UCTRL_H2LOCKD		(1 << 12)	/* HOST2 lock disable */
 
 #define UCTRL_PP                (1 << 11)       /* power polarity bit */
 #define UCTRL_H1WIE		(1 << 11)	/* HOST1 wakeup intr enable */
-- 
1.5.4.4

